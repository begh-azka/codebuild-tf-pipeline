# Step 1: Approval Step
steps:
- name: 'hashicorp/terraform'
  entrypoint: 'sh'
  args:
      - '-c'
      - |
        echo "Review Terraform Plan:"
        terraform show tfplan
        echo "Please review the plan. If it looks good, approve the build. If not, cancel it."
        if [ -d "env/$BRANCH_NAME/" ]; then
        cd env/$BRANCH_NAME      
        terraform apply -auto-approve
        else
        echo "***************************** SKIPPING APPLYING *******************************"
        echo "Branch '$BRANCH_NAME' does not represent an official environment."
        echo "*******************************************************************************"
      fi

logsBucket: 'gs://logs-cb-cloudbuild'
options:
    logging: GCS_ONLY
